<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Angielski Klasa 4 - Wybierz Kategorię</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding-top: 50px; background: #f0f2f5; }
        .quiz-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 500px; min-height: 300px; }
        .stats { display: flex; justify-content: space-between; color: #666; margin-bottom: 20px; }
        .category-btn { width: 100%; padding: 15px; margin: 10px 0; background: #6f42c1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .category-btn:hover { background: #5a32a3; transform: scale(1.02); }
        input { width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #checkBtn { background: #007bff; color: white; }
        #nextBtn { background: #6c757d; color: white; margin-top: 10px; }
        .hidden { display: none; }
        #feedback { margin-top: 15px; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; }
        .correct-box { background: #d4edda; color: #155724; }
        .wrong-box { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="quiz-container" id="main-container">
    <div id="category-screen">
        <h2 style="text-align:center">Wybierz kategorię testu:</h2>
        <div id="category-list">
            <p style="text-align:center">Wczytywanie kategorii...</p>
        </div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="stats">
            <span id="progress">Pytanie: 0/0</span>
            <span id="score">Punkty: 0</span>
        </div>
        <div style="width: 100%; background: #eee; border-radius: 10px; height: 10px; margin-bottom: 20px;">
    <div id="progressBar" style="width: 0%; background: #6f42c1; height: 100%; border-radius: 10px; transition: 0.5s;"></div>
</div>
        <h2 id="question">Pytanie</h2>
        <div id="inputArea">
            <input type="text" id="answerInput" placeholder="Twoja odpowiedź..." autocomplete="off" autofocus>
            <button id="checkBtn" class="btn" onclick="checkAnswer()">Sprawdź odpowiedź</button>
        </div>
        <div id="feedback" class="hidden"></div>
        <button id="nextBtn" class="btn hidden" onclick="displayQuestion()">Następne pytanie &rarr;</button>
    </div>
</div>

<script>
    let allData = [];
    let quizData = [];
    let currentStep = 0;
    let score = 0;
    let wrongAnswers = [];

    // 1. Pobieranie nowego formatu JSON
    fetch('pytania.json?v=' + Date.now())
        .then(response => response.json())
        .then(data => {
            allData = data;
            renderCategories();
        });

    // 2. Wyświetlanie przycisków kategorii
    function renderCategories() {
        const list = document.getElementById('category-list');
        list.innerHTML = "";
        allData.forEach((item, index) => {
            const btn = document.createElement('button');
            btn.className = 'category-btn';
            btn.innerText = item.category;
            btn.onclick = () => startQuiz(index);
            list.appendChild(btn);
        });
    }

    // 3. Rozpoczęcie wybranego quizu
    function startQuiz(index) {
        quizData = allData[index].questions;
        currentStep = 0;
        score = 0;
        wrongAnswers = [];
        
        document.getElementById('category-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        displayQuestion();
    }

    function displayQuestion() {
    if (currentStep < quizData.length) {
        // --- LOGIKA PASKA POSTĘPU ---
        // Obliczamy procent: (aktualne pytanie / suma pytań) * 100
        const progressPercent = (currentStep / quizData.length) * 100;
        document.getElementById('progressBar').style.width = progressPercent + "%";
        // ----------------------------

        document.getElementById('question').innerText = quizData[currentStep].q;
        document.getElementById('progress').innerText = `Pytanie: ${currentStep + 1}/${quizData.length}`;
        document.getElementById('score').innerText = `Punkty: ${score}`;
        
        document.getElementById('answerInput').value = "";
        document.getElementById('answerInput').disabled = false;
        document.getElementById('inputArea').classList.remove('hidden');
        document.getElementById('feedback').className = 'hidden';
        document.getElementById('nextBtn').classList.add('hidden');
        document.getElementById('answerInput').focus();
    } else {
        // Gdy koniec, ustaw pasek na 100%
        document.getElementById('progressBar').style.width = "100%";
        showSummary();
    }
}

    function checkAnswer() {
        const inputField = document.getElementById('answerInput');
        const userInput = inputField.value.trim().toLowerCase();
        const correctAnswer = quizData[currentStep].a;
        const feedback = document.getElementById('feedback');

        inputField.disabled = true;
        document.getElementById('inputArea').classList.add('hidden');
        feedback.classList.remove('hidden');

        if (userInput === correctAnswer.toLowerCase()) {
            score++;
            feedback.innerText = "Poprawnie!";
            feedback.className = "correct-box";
        } else {
            feedback.innerHTML = `Błąd!<br>Prawidłowa odpowiedź: <strong>${correctAnswer}</strong>`;
            feedback.className = "wrong-box";
            wrongAnswers.push(quizData[currentStep]);
        }
        document.getElementById('nextBtn').classList.remove('hidden');
        currentStep++;
    }

    function showSummary() {
        const percent = Math.round((score / quizData.length) * 100);
        let html = `
            <div style="text-align:center">
                <h2>Koniec kategorii!</h2>
                <p style="font-size: 2em; margin: 10px 0;">${score} / ${quizData.length}</p>
                <p>Wynik: <strong>${percent}%</strong></p>
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
        `;

        if (wrongAnswers.length > 0) {
            html += `<button class="btn" style="background:#dc3545; color:white; margin-bottom: 10px;" onclick="retryErrors()">Powtórz tylko błędy</button>`;
        }
        
        html += `<button class="btn" style="background:#007bff; color:white;" onclick="location.reload()">Wróć do wyboru kategorii</button></div>`;
        document.getElementById('quiz-screen').innerHTML = html;
    }

    function retryErrors() {
        quizData = [...wrongAnswers];
        wrongAnswers = [];
        currentStep = 0;
        score = 0;
        location.reload(); // Najbezpieczniej przeładować, by odświeżyć UI
    }

    document.getElementById('answerInput').addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !document.getElementById('answerInput').disabled) checkAnswer();
    });
</script>
</body>
</html>

