<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Interaktywny Quiz - Tryb Nauki</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding-top: 50px; background: #f0f2f5; }
        .quiz-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 450px; }
        .stats { display: flex; justify-content: space-between; color: #666; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #checkBtn { background: #007bff; color: white; }
        #nextBtn { background: #6c757d; color: white; margin-top: 10px; }
        #checkBtn:hover { background: #0056b3; }
        #nextBtn:hover { background: #5a6268; }
        .hidden { display: none; }
        #feedback { margin-top: 15px; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; }
        .correct-box { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .wrong-box { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div class="stats">
        <span id="progress">Pytanie: 0/0</span>
        <span id="score">Punkty: 0</span>
    </div>
    <h2 id="question">Wczytywanie...</h2>
    
    <div id="inputArea">
       <input type="text" id="answerInput" placeholder="Twoja odpowiedź..." autofocus autocomplete="off">
        <button id="checkBtn" class="btn" onclick="checkAnswer()">Sprawdź odpowiedź</button>
    </div>

    <div id="feedback" class="hidden"></div>
    <button id="nextBtn" class="btn hidden" onclick="displayQuestion()">Następne pytanie &rarr;</button>
</div>

<script>
    let quizData = [];
    let currentStep = 0;
    let score = 0;
    let wrongAnswers = []; // Tu będziemy przechowywać błędne pytania

    // Ładowanie z pliku pytania.json
    fetch('pytania.json')
        .then(response => response.json())
        .then(data => {
            quizData = data;
            initQuiz();
        });

    function initQuiz() {
        document.getElementById('progress').innerText = `Pytanie: 1/${quizData.length}`;
        displayQuestion();
    }

    function displayQuestion() {
        if (currentStep < quizData.length) {
            const q = quizData[currentStep];
            document.getElementById('question').innerText = q.q;
            document.getElementById('progress').innerText = `Pytanie: ${currentStep + 1}/${quizData.length}`;
            
            // Reset interfejsu
            document.getElementById('answerInput').value = "";
            document.getElementById('answerInput').disabled = false;
            document.getElementById('inputArea').classList.remove('hidden');
            document.getElementById('feedback').className = 'hidden';
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('answerInput').focus();
        } else {
            showSummary();
        }
    }

    function checkAnswer() {
    const inputField = document.getElementById('answerInput');
    const userInput = inputField.value.trim().toLowerCase();
    const correctAnswer = quizData[currentStep].a;
    const feedback = document.getElementById('feedback');

    inputField.disabled = true;
    document.getElementById('inputArea').classList.add('hidden');
    feedback.classList.remove('hidden');

    if (userInput === correctAnswer.toLowerCase()) {
        score++;
        feedback.innerText = "Doskonale! To poprawna odpowiedź.";
        feedback.className = "correct-box";
    } else {
        feedback.innerHTML = `Błąd!<br>Prawidłowa odpowiedź: <strong>${correctAnswer}</strong>`;
        feedback.className = "wrong-box";
        
        // DODAJEMY TO: Zapisujemy całe pytanie do listy błędów
        wrongAnswers.push(quizData[currentStep]);
    }

    document.getElementById('score').innerText = `Punkty: ${score}`;
    document.getElementById('nextBtn').classList.remove('hidden');
    currentStep++;
}

    function showSummary() {
    const percent = Math.round((score / quizData.length) * 100);
    const container = document.querySelector('.quiz-container');
    
    let html = `
        <div style="text-align:center">
            <h2>Koniec testu!</h2>
            <p style="font-size: 2em; margin: 10px 0;">${score} / ${quizData.length}</p>
            <p>Wynik: <strong>${percent}%</strong></p>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
    `;

    if (wrongAnswers.length > 0) {
        html += `
            <p>Masz błędy w ${wrongAnswers.length} pytaniach.</p>
            <button class="btn" style="background:#dc3545; color:white; margin-bottom: 10px;" onclick="retryErrors()">Powtórz tylko błędy</button>
        `;
    } else {
        html += `<p style="color: green; font-weight: bold;">Brawo! Zero błędów!</p>`;
    }

    html += `
            <button class="btn" style="background:#007bff; color:white;" onclick="location.reload()">Zacznij cały test od nowa</button>
        </div>`;
    
    container.innerHTML = html;
}

// Funkcja, która podmienia bazę pytań na te błędne i resetuje test
function retryErrors() {
    quizData = [...wrongAnswers]; // Pytania to teraz tylko te z błędami
    wrongAnswers = [];            // Czyścimy listę błędów na nową rundę
    currentStep = 0;
    score = 0;
    
    // Przywracamy wygląd interfejsu (bo summary go nadpisało)
    const container = document.querySelector('.quiz-container');
    container.innerHTML = `
        <div class="stats">
            <span id="progress">Pytanie: 0/0</span>
            <span id="score">Punkty: 0</span>
        </div>
        <h2 id="question">Wczytywanie...</h2>
        <div id="inputArea">
            <input type="text" id="answerInput" placeholder="Twoja odpowiedź..." autofocus autocomplete="off">
            <button id="checkBtn" class="btn" style="background:#007bff; color:white;" onclick="checkAnswer()">Sprawdź odpowiedź</button>
        </div>
        <div id="feedback" class="hidden"></div>
        <button id="nextBtn" class="btn hidden" style="background:#6c757d; color:white; margin-top: 10px;" onclick="displayQuestion()">Następne pytanie &rarr;</button>
    `;
    
    // Musimy ponownie podpiąć Enter dla nowego inputa
    document.getElementById('answerInput').addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !document.getElementById('answerInput').disabled) checkAnswer();
    });

    displayQuestion();
}
// Opcjonalna funkcja zakończenia
function finishQuiz() {
    document.querySelector('.quiz-container').innerHTML = `
        <div style="text-align:center">
            <h2>Dziękujemy za udział!</h2>
            <p>Możesz teraz zamknąć tę kartę.</p>
        </div>`;
}
    // Obsługa Enter
    document.getElementById('answerInput').addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !document.getElementById('answerInput').disabled) checkAnswer();
    });
</script>

</body>

</html>



